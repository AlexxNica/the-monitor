<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Monitoring 101: Investigating performance issues &mdash; the monitor 0.1 ドキュメント</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="top" title="the monitor 0.1 ドキュメント" href="../index.html" />
    <link rel="up" title="基本編" href="index.html" />
    <link rel="prev" title="Monitoring 101: Collecting the right data" href="monitoring_101_collecting_the_right_data..html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="monitoring-101-investigating-performance-issues">
<span id="monitoring-101-investigating-performance-issues"></span><h1>Monitoring 101: Investigating performance issues<a class="headerlink" href="#monitoring-101-investigating-performance-issues" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><em>This post is part of a series on effective monitoring. Be sure to check out the rest of the series: <a class="reference external" href="/blog/monitoring-101-collecting-data/">Collecting the right data</a> and <a class="reference external" href="/blog/monitoring-101-alerting/">Alerting on what matters</a>.</em></p>
<p>The responsibilities of a monitoring system do not end with symptom detection. Once your monitoring system has notified you of a real symptom that requires attention, its next job is to help you diagnose the root cause. Often this is the least structured aspect of monitoring, driven largely by hunches and guess-and-check. This post describes a more directed approach that can help you to find and correct root causes more efficiently.</p>
<p>This series of articles comes out of our experience monitoring large-scale infrastructure for <a class="reference external" href="https://www.datadoghq.com/customers/">our customers</a>. It also draws on the work of <a class="reference external" href="http://dtdg.co/use-method">Brendan Gregg</a>, <a class="reference external" href="http://dtdg.co/philosophy-alerting">Rob Ewaschuk</a>, and <a class="reference external" href="http://dtdg.co/metrics-attention">Baron Schwartz</a>.</p>
<div class="section" id="a-word-about-data">
<span id="a-word-about-data"></span><h2>A word about data<a class="headerlink" href="#a-word-about-data" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><img alt="metric types" src="https://d33tyra1llx9zy.cloudfront.net/blog/images/2015-05-how-to-monitor/alerting101_chart_1.png" /></p>
<p>There are three main types of monitoring data that can help you investigate the root causes of problems in your infrastructure. Data types and best practices for their collection are discussed in-depth <a class="reference external" href="https://www.datadoghq.com/blog/2015/06/monitoring-101-collecting-data/">in a companion post</a>, but in short:</p>
<ul class="simple">
<li><strong>Work metrics</strong> indicate the top-level health of your system by measuring its useful output</li>
<li><strong>Resource metrics</strong> quantify the utilization, saturation, errors, or availability of a resource that your system depends on</li>
<li><strong>Events</strong> describe discrete, infrequent occurrences in your system such as code changes, internal alerts, and scaling events</li>
</ul>
<p>By and large, work metrics will surface the most serious symptoms and should therefore generate <a class="reference external" href="https://www.datadoghq.com/blog/2015/06/monitoring-101-alerting/#page-on-symptoms">the most serious alerts</a>. But the other metric types are invaluable for investigating the <em>causes</em> of those symptoms.</p>
</div>
<div class="section" id="its-resources-all-the-way-down">
<span id="its-resources-all-the-way-down"></span><h2>It’s resources all the way down<a class="headerlink" href="#its-resources-all-the-way-down" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><img alt="metric uses" src="https://d33tyra1llx9zy.cloudfront.net/blog/images/2015-05-how-to-monitor/alerting101_2_chart.png" /></p>
<p>Most of the components of your infrastructure can be thought of as resources. At the highest levels, each of your systems that produces useful work likely relies on other systems. For instance, the Apache server in a LAMP stack relies on a MySQL database as a resource to support its work. One level down, within MySQL are database-specific resources that MySQL uses to do <em>its</em> work, such as the finite pool of client connections. At a lower level still are the physical resources of the server running MySQL, such as CPU, memory, and disks.</p>
<p>Thinking about which systems <em>produce</em> useful work, and which resources <em>support</em> that work, can help you to efficiently get to the root of any issues that surface. When an alert notifies you of a possible problem, the following process will help you to approach your investigation systematically.</p>
<p><img alt="recursive investigation" src="https://d33tyra1llx9zy.cloudfront.net/blog/images/2015-05-how-to-monitor/investigating_diagram_4.png" /></p>
<div class="section" id="start-at-the-top-with-work-metrics">
<span id="start-at-the-top-with-work-metrics"></span><h3>1. Start at the top with work metrics<a class="headerlink" href="#start-at-the-top-with-work-metrics" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>First ask yourself, “Is there a problem? How can I characterize it?” If you don’t describe the issue clearly at the outset, it’s easy to lose track as you dive deeper into your systems to diagnose the issue.</p>
<p>Next examine the work metrics for the highest-level system that is exhibiting problems. These metrics will often point to the source of the problem, or at least set the direction for your investigation. For example, if the percentage of work that is successfully processed drops below a set threshold, diving into error metrics, and especially the types of errors being returned, will often help narrow the focus of your investigation. Alternatively, if latency is high, and the throughput of work being requested by outside systems is also very high, perhaps the system is simply overburdened.</p>
</div>
<div class="section" id="dig-into-resources">
<span id="dig-into-resources"></span><h3>2. Dig into resources<a class="headerlink" href="#dig-into-resources" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>If you haven’t found the cause of the problem by inspecting top-level work metrics, next examine the resources that the system uses—physical resources as well as software or external services that serve as resources to the system. If you’ve already set up dashboards for each system as outlined below, you should be able to quickly find and peruse metrics for the relevant resources. Are those resources unavailable? Are they highly utilized or saturated? If so, recurse into those resources and begin investigating each of them at step 1.</p>
</div>
<div class="section" id="did-something-change">
<span id="did-something-change"></span><h3>3. Did something change?<a class="headerlink" href="#did-something-change" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Next consider alerts and other events that may be correlated with your metrics. If a code release, <a class="reference external" href="https://www.datadoghq.com/blog/2015/06/monitoring-101-alerting/#levels-of-urgency">internal alert</a>, or other event was registered slightly before problems started occurring, investigate whether they may be connected to the problem.</p>
</div>
<div class="section" id="fix-it-and-dont-forget-it">
<span id="fix-it-and-dont-forget-it"></span><h3>4. Fix it (and don’t forget it)<a class="headerlink" href="#fix-it-and-dont-forget-it" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Once you have determined what caused the issue, correct it. Your investigation is complete when symptoms disappear—you can now think about how to change the system to avoid similar problems in the future.</p>
</div>
</div>
<div class="section" id="build-dashboards-before-you-need-them">
<span id="build-dashboards-before-you-need-them"></span><h2>Build dashboards before you need them<a class="headerlink" href="#build-dashboards-before-you-need-them" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference external" href="https://d33tyra1llx9zy.cloudfront.net/blog/images/2015-05-how-to-monitor/example-dashboard-2.png"><img alt="dashboard" src="https://d33tyra1llx9zy.cloudfront.net/blog/images/2015-05-how-to-monitor/example-dashboard-2.png" /></a></p>
<p>In an outage, every minute is crucial. To speed your investigation and keep your focus on the task at hand, set up dashboards in advance. You may want to set up one dashboard for your high-level application metrics, and one dashboard for each subsystem. Each system’s dashboard should render the work metrics of that system, along with resource metrics of the system itself and key metrics of the subsystems it depends on. If event data is available, overlay relevant events on the graphs for correlation analysis.</p>
</div>
<div class="section" id="conclusion-follow-the-metrics">
<span id="conclusion-follow-the-metrics"></span><h2>Conclusion: Follow the metrics<a class="headerlink" href="#conclusion-follow-the-metrics" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Adhering to a standardized monitoring framework allows you to investigate problems more systematically:</p>
<ul class="simple">
<li>For each system in your infrastructure, set up a dashboard ahead of time that displays all its key metrics, with relevant events overlaid.</li>
<li>Investigate causes of problems by starting with the highest-level system that is showing symptoms, reviewing its <a class="reference external" href="https://www.datadoghq.com/blog/2015/06/monitoring-101-collecting-data/#metrics">work and resource metrics</a> and any associated events.</li>
<li>If problematic resources are detected, apply the same investigation pattern to the resource (and its constituent resources) until your root problem is discovered and corrected.</li>
</ul>
<p>We would like to hear about your experiences as you apply this framework to your own monitoring practice. If it is working well, please <a class="reference external" href="https://twitter.com/datadoghq">let us know on Twitter</a>! Questions, corrections, additions, complaints, etc? Please <a class="reference external" href="https://github.com/DataDog/the-monitor/blob/master/monitoring-101/monitoring_101_investigating_performance_issues.md">let us know on GitHub</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">Monitoring 101: Investigating performance issues</a><ul>
<li><a class="reference internal" href="#a-word-about-data">A word about data</a></li>
<li><a class="reference internal" href="#its-resources-all-the-way-down">It’s resources all the way down</a><ul>
<li><a class="reference internal" href="#start-at-the-top-with-work-metrics">1. Start at the top with work metrics</a></li>
<li><a class="reference internal" href="#dig-into-resources">2. Dig into resources</a></li>
<li><a class="reference internal" href="#did-something-change">3. Did something change?</a></li>
<li><a class="reference internal" href="#fix-it-and-dont-forget-it">4. Fix it (and don’t forget it)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-dashboards-before-you-need-them">Build dashboards before you need them</a></li>
<li><a class="reference internal" href="#conclusion-follow-the-metrics">Conclusion: Follow the metrics</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">基本編</a><ul>
      <li>Previous: <a href="monitoring_101_collecting_the_right_data..html" title="前の章へ">Monitoring 101: Collecting the right data</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/monitoring-101/monitoring_101_investigating_performance_issues..txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Datadog.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="../_sources/monitoring-101/monitoring_101_investigating_performance_issues..txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>